# NewsPicGen

NewsPicGen: News Picture Prompt Generation Modelæ˜¯ä¸€ä¸ªä¸­æ–‡æ–°é—»é…å›¾ç”Ÿæˆæ¨¡å‹ï¼Œä½¿ç”¨[Qwen2.5-1.5B-Instruct](https://huggingface.co/Qwen/Qwen2.5-1.5B-Instruct)ä½œä¸ºåŸºåº§æ¨¡å‹ï¼Œä½¿ç”¨SFTè¿›è¡Œå¾®è°ƒã€‚
å¯ä»¥ç”Ÿæˆä¸æ–°é—»å†…å®¹ç›¸å…³çš„é«˜è´¨é‡çš„ä¸­è‹±åŒæ–‡é…å›¾promptã€ä¸­è‹±åŒæ–‡å…³é”®å­—å’Œç»˜ç”»ç±»å‹ã€‚ç›´æ¥é€šè¿‡Stable Diffusionç”Ÿæˆé…å›¾ï¼Œå¯æ ¹æ®ç»˜ç”»ç±»å‹é…ç½®ä¸åŒçš„ç»˜å›¾æ¨¡æ¿ï¼Œç”Ÿæˆå¤šç§é£æ ¼çš„é…å›¾ã€‚

<table>
    <tr>
        <td>
            <img src="images/081800-fab7cae0-0426-4bf3-9221-9c5dee992caf-3998970961.png" alt="" style="zoom:50%;" />
        </td>
        <td>
            <img src="images/093033-278f8bc6-b333-4dea-bdd6-87b9ba480217-1377011191.png" alt="" style="zoom:50%;" />
        </td>
        <td>
            <img src="images/093729-ec593819-c510-43f4-bffe-5645849898e3-717896971.png" alt="" style="zoom:50%;" />
        </td>
        <td>
            <img src="images/093930-171781b5-c41e-44f2-94dd-adb7d324b7db-1838043457.png" alt="" style="zoom:50%;" />
        </td>
    </tr>
</table>

<p align="center">
        ğŸ¤— <a href="https://huggingface.co/blacker521/NewsPicGen/">Hugging Face</a>&nbsp&nbsp | &nbsp&nbspğŸ¤– <a href="https://modelscope.cn/models/blacker521/NewsPicGen">ModelScope</a>&nbsp&nbsp | &nbsp&nbspğŸ’» <a href="https://github.com/blacker521/NewsPicGen">Github</a>
</p>

## æ ·ä¾‹

ä»¥ä¸‹æ ·ä¾‹ä½¿ç”¨NewsPicGenç”Ÿæˆç»˜ç”»æŒ‡ä»¤ï¼Œä½¿ç”¨é…ç½®æ¨¡æ¿å’ŒStable Diffusionç”Ÿæˆé…å›¾ã€‚
<!--  -->
<table>
    <tr>
        <th>æ–°é—»</th>
        <th style="width: 150px;">è‹±æ–‡ç»˜ç”»æŒ‡ä»¤</th>
        <th>ä¸­æ–‡å…³é”®è¯</th>
        <th>å›¾ç‰‡</th>
    </tr>
    <tr>
        <td><a href="https://baijiahao.baidu.com/s?id=1810945829190023515">å¿ƒè„‘è¡€ç®¡ç–¾ç—…æ‚£è€…å®œåƒçš„â€œå½©è‰²â€ç¾é£Ÿ</a></td>
        <td>Draw a colorful dining table with various "colored" foods such as tomatoes, carrots, corn, spinach, and purple cabbage.</td>
        <td>å¿ƒè„‘è¡€ç®¡ç–¾ç—…ï¼Œè‰²å½©å®ˆæŠ¤</td>
        <td><img src="images/081800-fab7cae0-0426-4bf3-9221-9c5dee992caf-3998970961.png" alt="" style="zoom:50%;" /></td>
    </tr>
    <tr>
        <td><a href="https://baijiahao.baidu.com/s?id=1810963351722892019">3762äººå±•ç¤ºå¤ªææ‰‡æŒ‘æˆ˜æˆåŠŸï¼åŸºå°¼æ–¯ä¸–ç•Œçºªå½•åœ¨å¹¿å·é»„åŸ”é¾™æ¹–è¯ç”Ÿ</a></td>
        <td>The center of the picture is an elderly man in a Tai Chi suit, he is waving the red Tai Chi fan with perfect movements and full vitality...</td>
        <td>å¤ªææ‰‡ï¼Œä¼ æ‰¿åƒå¹´æ–‡åŒ–</td>
        <td><img src="images/093033-278f8bc6-b333-4dea-bdd6-87b9ba480217-1377011191.png" alt="" style="zoom:50%;" /></td>
    </tr>
    <tr>
        <td><a href="https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=3094286144295671472&source=50001&sub_source=50001_006">ç‚¹èµï¼é’å²›ä¸¤åå¤§å­¦ç”Ÿæ¡åˆ°ä¸€æ–¤å¤šé»„é‡‘äº¤è¿˜å¤±ä¸»!</a></td>
        <td>Draw a scene of two college students carrying backpacks, smiling, finding a black business handbag on the roadside with some golden items inside, and police officers questioning around."</td>
        <td>å¤§å­¦ç”Ÿæ‹¾é‡‘ä¸æ˜§</td>
        <td><img src="images/093729-ec593819-c510-43f4-bffe-5645849898e3-717896971.png" alt="" style="zoom:50%;" /></td>
    </tr>
    <tr>
        <td><a href="https://baijiahao.baidu.com/s?id=1810886409729822758">é©¶å‘â€œæœªæ¥ä¹‹åŸâ€</a></td>
        <td>Draw a city background with high-tech elements in the middle, surrounded by various types of flying machines. The color scheme is mainly blue and white to symbolize technology and futurism.</td>
        <td>é©¶å‘æœªæ¥ï¼Œæ™ºè¡Œå¤©ä¸‹ï¼</td>
        <td><img src="images/093930-171781b5-c41e-44f2-94dd-adb7d324b7db-1838043457.png" alt="" style="zoom:50%;" /></td>
    </tr>
</table>

## åŠŸèƒ½ 
- ç”Ÿæˆä¸æ–°é—»å†…å®¹ç›¸å…³çš„é«˜è´¨é‡çš„ä¸­è‹±åŒæ–‡é…å›¾promptã€ä¸­è‹±æ–‡å…³é”®å­—å’Œç»˜ç”»ç±»å‹ã€‚
- å¾®è°ƒæ•°æ®ä½¿ç”¨ä¸‡çº§æ–°é—»æ•°æ®ï¼Œå¹¶é‡‡ç”¨å¤šä»»åŠ¡è¿›è¡ŒSFTå¾®è°ƒï¼Œåœ¨ç”Ÿæˆç»˜ç”»promptçš„åŒæ—¶ï¼Œå¯¹ç»˜ç”»ç±»å‹ï¼ˆ1.åŠ¨ç‰©ã€2.äººã€3.äººç¾¤ã€4.é£æ™¯ã€5.å»ºç­‘ã€6.ç§‘æŠ€äº§å“ã€7.ç‰©å“ã€8.å…¶ä»–ï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œå¼ºåŒ–æ¨¡å‹è¾“å‡ºæ•ˆæœã€‚å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç»˜ç”»ç±»å‹ï¼Œé…ç½®ä¸åŒçš„ç»˜ç”»æ¨¡æ¿ã€‚
- æ”¯æŒJSONæ ¼å¼åŒ–è¾“å‡ºï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚
- ç”Ÿæˆå›¾ç‰‡ä¸ºæ¼«ç”»é£æ ¼ï¼Œå¯¹äºæ–°é—»é…å›¾æœ‰è¾ƒå¥½çš„è¡¨ç°ã€‚
## æ€§èƒ½

- ä½¿ç”¨QWen2.5-1.5B-Instructä½œä¸ºåŸºåº§æ¨¡å‹ï¼Œä¸­ç­‰é•¿åº¦æ–°é—»ç”Ÿæˆç»˜ç”»æŒ‡ä»¤å¹³å‡è€—æ—¶500msï¼ˆA100-80Gï¼‰ï¼Œé…åˆ[SGLang](https://github.com/modelscope/sglang)/[vllm](https://github.com/vllm-project/vllm)ç­‰æ¡†æ¶å¯ä»¥æ›´å¿«çš„ç”Ÿæˆç»˜ç”»æŒ‡ä»¤ã€‚
- å¯ä»¥åœ¨æ¶ˆè´¹çº§æ˜¾å¡ä¸Šè¿è¡Œã€‚

## å¿«é€Ÿå¼€å§‹

### ğŸ¤— Hugging Face Transformers

ä½¿ç”¨Transformersç”Ÿæˆç»˜ç”»æŒ‡ä»¤

```python
import json
from transformers import AutoModelForCausalLM, AutoTokenizer

model_name = "blacker521/NewsPicGen"

model = AutoModelForCausalLM.from_pretrained(
    model_name,
    torch_dtype="auto",
    device_map="auto"
)
tokenizer = AutoTokenizer.from_pretrained(model_name)


title = "å­™é¢–èè°ˆå¤§æ»¡è´¯æœ€å¤§çš„æŒ‘æˆ˜"
content = "#å­™é¢–èå¸Œæœ›æ‰¾åˆ°èµ›åœºä¸Šæ‹¼æçš„çŠ¶æ€# 9æœˆ24æ—¥ï¼Œæ˜¯WTTä¸­å›½å¤§æ»¡è´¯2024å€’è®¡æ—¶2å¤©ï¼Œçƒå‘˜@å­™é¢–è æ¥å—ä¸“è®¿ã€‚å­™é¢–èåœ¨é‡‡è®¿ä¸­è°ˆåŠå¤§æ»¡è´¯ä¸­æœ€å¤§çš„æŒ‘æˆ˜ï¼Œå¥¹è¡¨ç¤ºå¤§æ»¡è´¯å·²ç»æ˜¯å¾ˆé¡¶å°–çš„èµ›äº‹æ°´å¹³äº†ï¼Œæ‰€ä»¥æ¯åœºçƒéƒ½ä¼šæœ‰æŒ‘æˆ˜ï¼Œå¸Œæœ›è‡ªå·±èƒ½æ‰¾åˆ°ç§¯æä¸“æ³¨çš„åœ¨èµ›åœºä¸Šæ‹¼æçš„çŠ¶æ€ã€‚"
prompt = f'ä»¥ä¸‹æ˜¯ä¸€ç¯‡æ–°é—»ï¼Œæ ‡é¢˜â€œ{title}â€ã€‚æ–°é—»å†…å®¹ï¼š{content}ï¼Œè¯·æ ¹æ®æ–°é—»å†…å®¹ç”Ÿæˆç»˜ç”»æŒ‡ä»¤ï¼Œå›¾ç‰‡è¦ç¬¦åˆæ–°é—»å†…å®¹ï¼Œå¹¶ä¸”æœ‰åˆ›æ„ã€‚'
messages = [
    {"role": "user", "content": prompt}
]
text = tokenizer.apply_chat_template(
    messages,
    tokenize=False,
    add_generation_prompt=True
)
model_inputs = tokenizer([text], return_tensors="pt").to(model.device)

generated_ids = model.generate(
    **model_inputs,
    max_new_tokens=512
)
generated_ids = [
    output_ids[len(input_ids):] for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
]

response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
print(json.dumps(response, ensure_ascii=False))
# {
#    "ch_keyword": "æŒ‘æˆ˜å¤§æ»¡è´¯ï¼Œå…¨åŠ›ä»¥èµ´",
#    "ch_prompt": "ç”»ä¸€ä¸ªæ­£åœ¨æ¯”èµ›ä¸­å¥‹åŠ›æ‹¼æçš„å¥³å­ä¹’ä¹“çƒè¿åŠ¨å‘˜ï¼Œå¥¹çš„é¢åºå……æ»¡æ–—å¿—å’Œå†³å¿ƒï¼Œæ‰‹ä¸­æ¡ç€ä¹’ä¹“çƒæ‹ï¼Œçœ¼ç›ç´§ç›¯ç€å¯¹æ‰‹ï¼ŒèƒŒæ™¯ä¸ºè§‚ä¼—å¸­ä¸Šçš„æ¬¢å‘¼å£°ã€‚",
#    "en_keyword": "Challenging Grand Slam",
#    "en_prompt": "Draw a female table tennis player in the middle of an intense match, her face filled with determination and resolve, holding a ping pong paddle in her hand, staring at her opponent closely, and the cheering from the audience in the background.",
#    "type": "2"
# }
```